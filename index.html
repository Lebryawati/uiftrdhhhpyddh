<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Laboratorium Fisika Teori & Komputasi - Universitas Hasanuddin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0f1724; /* deep navy */
  --card:#0b1220;
  --muted:#9aa7bf;
  --accent1:#b91c1c; /* merah Unhas */
  --accent2:#0b69b3; /* biru */
  --glass: rgba(255,255,255,0.03);
  --radius:14px;
  --shadow: 0 10px 30px rgba(2,6,23,0.6);
}
*{box-sizing:border-box}
html,body{
  margin:0;
  font-family:Inter,system-ui;
  background:radial-gradient(circle at 50% 50%, #0d1b2a, #000814 70%, #000000);
  background-attachment:fixed;
  color:var(--dark);
  line-height:1.5;
  position:relative;
  overflow-x:hidden;
}
body::before{
  content:"";
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:url('https://www.transparenttextures.com/patterns/stardust.png');
  opacity:0.35;
  pointer-events:none;
}
body{
  margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background:linear-gradient(140deg,var(--bg),#071020 120%);
  color:#e6eef8;
  -webkit-font-smoothing:antialiased;
}
.container{max-width:1200px;margin:26px auto;padding:20px}
header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px;border-radius:14px;background:linear-gradient(90deg,var(--glass),rgba(255,255,255,0.02));box-shadow:var(--shadow);backdrop-filter:blur(6px)}
.brand{display:flex;align-items:center;gap:12px}
.logo-wrap{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center}
.logo-wrap img{width:56px;height:56px;object-fit:contain}
.title{line-height:1}
.title h1{margin:0;font-family:Montserrat;font-size:18px}
.title small{color:var(--muted)}
nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.navbtn{background:transparent;border:0;padding:8px 12px;border-radius:10px;color:var(--muted);cursor:pointer;font-weight:600}
.navbtn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 8px 22px rgba(11,18,32,0.6)}
.hero{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:20px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
.about h2{margin-top:0}
.stats{display:flex;gap:12px;margin-top:12px}
.stat{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));}
.stat b{display:block;font-size:20px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}
.gallery img{width:100%;height:100px;object-fit:cover;border-radius:8px;cursor:pointer;transition:transform .18s}
.gallery img:hover{transform:scale(1.03)}
.section{margin-top:18px}
.footer{margin-top:22px;text-align:center;color:var(--muted)}
/* responsive */
@media(max-width:950px){
  .hero{grid-template-columns:1fr}
}
/* forms and tables */
.form-row{display:flex;gap:10px}
.input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.table{width:100%;border-collapse:collapse;margin-top:12px}
.table th,.table td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
.card-actions{display:flex;gap:8px}
.small{color:var(--muted);font-size:13px}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:white;font-weight:700}
.modal{position:fixed;inset:0;background:rgba(2,6,23,0.75);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:opacity .18s}
.modal.show{visibility:visible;opacity:1}
.modal .box{background:#06121a;padding:18px;border-radius:12px;max-width:900px;width:96%;}
.profile-pic{width:84px;height:84px;border-radius:10px;object-fit:cover}
.cohort-row{display:flex;gap:8px;flex-wrap:wrap}
</style>

<style>
/* Galaxy background layers */
#starfield{position:fixed;inset:0;z-index:-2}
.parallax-layer{position:fixed;pointer-events:none;z-index:-1}
.parallax-layer.planet{width:400px;height:400px;border-radius:50%;opacity:0.12;filter:blur(18px)}
/* Glass UI stronger */
.card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.03)}
/* Section transition */
section{transition:opacity .35s, transform .35s}
section.hidden{opacity:0;transform:translateY(8px);pointer-events:none}
/* Music control */
#musicControl{border-radius:999px;padding:8px 12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;border:0;cursor:pointer}
/* Admin pin badge */
#adminBadge{background:#111;border-radius:8px;padding:6px 10px;color:#fff;border:1px solid rgba(255,255,255,0.04)}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo-wrap">
        <!-- official Unhas logo (Wikimedia Commons redirect) -->
        <img src="https://commons.wikimedia.org/wiki/Special:Redirect/file/Logo-Resmi-Unhas-1.png" alt="Logo Unhas">
      </div>
      <div class="title">
        <h1>Laboratorium Fisika Teori & Komputasi</h1>
        <small>Universitas Hasanuddin â€” Teori â€¢ Simulasi â€¢ Komputasi</small>
      </div>
    </div>
    <nav aria-label="Main nav">
      <button class="navbtn active" data-target="home">Beranda</button>
      <button class="navbtn" data-target="lab">Profil Lab</button>
      <button class="navbtn" data-target="dosen">Dosen</button>
      <button class="navbtn" data-target="mahasiswa">Mahasiswa</button>
      <button class="navbtn" data-target="research">Penelitian</button>
      <button class="navbtn" data-target="gallery">Galeri</button>
    </nav>
  </header>

  <main>
    <section id="home" class="hero">
      <div class="card about">
        <h2>Selamat datang</h2>
        <p class="small">Laboratorium Fisika Teori & Komputasi Universitas Hasanuddin â€” pusat penelitian dan pembelajaran yang memadukan teori, simulasi numerik, dan pemodelan komputasi. Temukan profil dosen, data mahasiswa per angkatan, proyek penelitian, serta karya visualisasi kami.</p>

        <div class="stats">
          <div class="stat"><span class="small">Jumlah Dosen</span><b id="stat-dosen">â€”</b><span class="small">Dosen & Peneliti</span></div>
          <div class="stat"><span class="small">Jumlah Mahasiswa</span><b id="stat-mahasiswa">â€”</b><span class="small">Per angkatan tersedia</span></div>
          <div class="stat"><span class="small">Proyek Aktif</span><b id="stat-projects">4</b><span class="small">Simulasi & Publikasi</span></div>
        </div>

        <div class="section">
          <h4>Fitur Unggulan</h4>
          <ul class="small">
            <li>Halaman terpisah untuk Dosen & Mahasiswa (upload foto + metadata)</li>
            <li>Data Mahasiswa dikelompokkan per angkatan (filter cepat)</li>
            <li>Ekspor / Impor CSV & JSON untuk backup</li>
            <li>Halaman Penelitian dengan ringkasan proyek dan link kode</li>
          </ul>
        </div>
      </div>

      <aside class="card">
        <h4 style="margin-top:0">Ringkasan Cepat</h4>
        <div class="gallery" id="homeGallery"></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="btnExport">Ekspor JSON</button>
          <label class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer">
            Impor
            <input id="importFile" type="file" accept=".json,.csv" style="display:none">
          </label>
        </div>
      </aside>
    </section>

    <!-- Profil Lab -->
    <section id="lab" class="card" style="display:none">
      <h3>Profil Laboratorium</h3>
      <p class="small">Laboratorium kami mengembangkan model numerik pada relativitas umum, fisika zat padat komputasi, dan pembelajaran mesin untuk analisis data eksperimental. Fasilitas: cluster CPU/GPU, akses HPC, software Python/Julia/C++ serta visualization stack.</p>
      <div class="grid-2" style="margin-top:12px">
        <div class="card small">
          <h4>Fasilitas</h4>
          <ul>
            <li>Cluster GPU (NVIDIA)</li>
            <li>Perangkat lunak: Python (NumPy, SciPy), Julia, C++</li>
            <li>Repositori kode & dataset internal</li>
          </ul>
        </div>
        <div class="card small">
          <h4>Kontak & Jadwal</h4>
          <p class="small">Email: labfisika@unhas.ac.id<br>Ruang: FMIPA Universitas Hasanuddin<br>Jam operasional: Seninâ€“Jumat 08:00â€“16:00</p>
        </div>
      </div>
    </section>

    <!-- Dosen -->
    <section id="dosen" class="card" style="display:none">
      <h3>Data Dosen & Peneliti</h3>
      <p class="small">Tambahkan profil dosen lengkap dengan foto dan bidang riset.</p>
      <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
        <div style="flex:1;min-width:320px">
          <label>Nama</label>
          <input id="dosen_name" class="input" placeholder="Nama lengkap">
          <label>Jabatan</label>
          <input id="dosen_role" class="input" placeholder="Dosen / Peneliti">
          <label>Email</label>
          <input id="dosen_email" class="input" placeholder="email@unhas.ac.id">
          <label>Bidang Riset</label>
          <input id="dosen_field" class="input" placeholder="Relativitas, Fisika Zat Padat..."></input>
          <label>Foto</label>
          <input id="dosen_photo" type="file" accept="image/*">
          <div style="margin-top:10px;display:flex;gap:10px">
            <button id="addDosen" class="btn">Tambahkan Dosen</button>
            <button id="clearDosen" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.05)">Bersihkan</button>
          </div>
        </div>
        <div style="flex:1;min-width:280px">
          <h4>Daftar Dosen</h4>
          <table class="table" id="tableDosen"><thead><tr><th>Foto</th><th>Nama</th><th>Bidang</th><th>Aksi</th></tr></thead><tbody></tbody></table>
        </div>
      </div>
    </section>

    <!-- Mahasiswa -->
    <section id="mahasiswa" class="card" style="display:none">
      <h3>Data Mahasiswa (per angkatan)</h3>
      <p class="small">Tambahkan mahasiswa dan kelompokan berdasarkan angkatan (tahun masuk).</p>
      <div class="card" style="margin-bottom:10px">
        <div class="form-row">
          <input id="mhs_name" class="input" placeholder="Nama mahasiswa">
          <select id="mhs_cohort" class="input">
            <!-- generate years by script -->
          </select>
          <input id="mhs_email" class="input" placeholder="email@unhas.ac.id">
          <input id="mhs_photo" type="file" accept="image/*">
          <button id="addMhs" class="btn">Tambahkan</button>
        </div>
      </div>

      <div class="cohort-row" style="margin-bottom:10px">
        <button class="btn" data-cohort="all">Semua</button>
      </div>

      <div id="mhsList"></div>
    </section>

    <!-- Research -->
    <section id="research" class="card" style="display:none">
      <h3>Galeri Penelitian</h3>
      <p>Unggah gambar hasil simulasi, visualisasi, atau dokumentasi riset.</p>
      <input type="file" id="galleryUpload" accept="image/*" style="margin-bottom:10px">
      <button class="btn primary" id="uploadGalleryBtn">Upload ke Galeri</button>
      <div class="gallery" id="gallery" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px"></div>
    </section>

    <!-- Gallery -->
    <section id="gallery" class="card" style="display:none">
      <h3>Galeri Visualisasi & Kegiatan</h3>
      <div class="gallery" id="galleryGrid"></div>
    </section>

  </main>

  <div class="footer">
    Â© <span id="year"></span> Laboratorium Fisika Teori & Komputasi â€” Universitas Hasanuddin
  </div>
</div>

<!-- Admin & Music Controls -->
<div style="position:fixed;top:16px;right:16px;z-index:999;display:flex;gap:8px;align-items:center">
  <button id="musicControl" title="Toggle ambient music">ðŸ”Š Music</button>
  <div id="adminBadge">Admin: <button id="adminBtn" class="btn">Login</button></div>
  <button id="exportZip" class="btn">Export Galeri (ZIP)</button>
</div>

<!-- Modal preview -->
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="box">
    <div style="display:flex;gap:12px;align-items:center">
      <img id="modalPic" class="profile-pic" src="" alt="preview">
      <div>
        <h4 id="modalTitle"></h4>
        <div class="small" id="modalSub"></div>
      </div>
      <div style="margin-left:auto"><button id="closeModal" class="btn">Tutup</button></div>
    </div>
  </div>
</div>

<script>
/* ===== Utilities ===== */
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const STORAGE = 'unhas_lab_v1';
let state = { dosen: [], mahasiswa: [] };

/* ===== Navigation ===== */
qsa('.navbtn').forEach(btn=>btn.addEventListener('click', ()=>{
  qsa('.navbtn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  ['home','lab','dosen','mahasiswa','research','gallery'].forEach(id=>{
    const el = qs('#'+id); if(!el) return; el.style.display = (id===btn.dataset.target)?'block':'none';
  });
  window.scrollTo({top:0,behavior:'smooth'});
}));

/* ===== Init years for cohorts =====n*/
(function populateYears(){
  const sel = qs('#mhs_cohort');
  const yearNow = new Date().getFullYear();
  for(let y=yearNow; y>=yearNow-8; y--){
    const opt = document.createElement('option'); opt.value = y; opt.textContent = y; sel.appendChild(opt);
  }
})();

/* ===== Load & Save ===== */
function load(){
  try{ const raw = localStorage.getItem(STORAGE); if(raw) state = JSON.parse(raw); }
  catch(e){ console.warn('load error',e); state={dosen:[],mahasiswa:[]} }
}
function save(){ localStorage.setItem(STORAGE, JSON.stringify(state)); renderAll(); }

/* ===== Render: home gallery + stats ===== */
function renderHome(){
  const g = qs('#homeGallery'); g.innerHTML='';
  // sample images
  for(let i=0;i<4;i++){ const img=document.createElement('img'); img.src=`https://picsum.photos/seed/unhas${i}/400/260`; img.alt='sample'; img.style.width='100%'; img.style.height='80px'; img.style.objectFit='cover'; img.style.borderRadius='8px'; g.appendChild(img); }
  qs('#stat-dosen').textContent = state.dosen.length;
  qs('#stat-mahasiswa').textContent = state.mahasiswa.length;
}

/* ===== Dosen functions ===== */
function renderDosen(){
  const tbody = qs('#tableDosen tbody'); tbody.innerHTML='';
  state.dosen.forEach((d,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><img src="${d.photo||placeholder(d.name)}" style="width:48px;height:48px;border-radius:8px;object-fit:cover"></td>
                    <td>${escape(d.name)}</td>
                    <td>${escape(d.field)}</td>
                    <td><div class="card-actions"><button class="btn" data-i="${i}" onclick="viewDosen(${i})">Lihat</button><button class="btn" onclick="delDosen(${i})">Hapus</button></div></td>`;
    tbody.appendChild(tr);
  });
}
function addDosenFromForm(){
  const name = qs('#dosen_name').value.trim(); if(!name) return alert('Nama dosen wajib');
  const role = qs('#dosen_role').value.trim(); const email = qs('#dosen_email').value.trim(); const field = qs('#dosen_field').value.trim();
  const f = qs('#dosen_photo').files[0];
  if(f){ fileToDataURL(f, 800).then(url=>{ state.dosen.push({name,role,email,field,photo:url}); save(); clearDosenForm(); }); }
  else{ state.dosen.push({name,role,email,field,photo:null}); save(); clearDosenForm(); }
}
function clearDosenForm(){ qs('#dosen_name').value=''; qs('#dosen_role').value=''; qs('#dosen_email').value=''; qs('#dosen_field').value=''; qs('#dosen_photo').value=''; }
function delDosen(i){ if(confirm('Hapus dosen?')){ state.dosen.splice(i,1); save(); } }
function viewDosen(i){ const d = state.dosen[i]; showModal(d.photo||placeholder(d.name), d.name, d.field + (d.email?('\n'+d.email):'')); }

/* ===== Mahasiswa functions ===== */
function renderMhs(cohort){
  const container = qs('#mhsList'); container.innerHTML='';
  const arr = cohort && cohort!=='all' ? state.mahasiswa.filter(m=>m.cohort==cohort) : state.mahasiswa;
  if(arr.length===0){ container.innerHTML='<p class="small">Tidak ada mahasiswa untuk pilihan ini.</p>'; return; }
  const grid = document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='repeat(auto-fit,minmax(220px,1fr))'; grid.style.gap='12px';
  arr.forEach((m,i)=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<div style="display:flex;gap:12px;align-items:center"><img src="${m.photo||placeholder(m.name)}" style="width:64px;height:64px;border-radius:10px;object-fit:cover"><div><strong>${escape(m.name)}</strong><div class="small">${m.email||''}</div><div class="small">Angkatan: ${m.cohort}</div></div></div><div style="margin-top:8px"><button class="btn" onclick="viewMhs(${i})">Lihat</button> <button class="btn" onclick="delMhs(${i})">Hapus</button></div>`;
    grid.appendChild(card);
  });
  container.appendChild(grid);
}
function addMhsFromForm(){
  const name = qs('#mhs_name').value.trim(); if(!name) return alert('Nama wajib');
  const cohort = qs('#mhs_cohort').value; const email = qs('#mhs_email').value.trim(); const f = qs('#mhs_photo').files[0];
  if(f){ fileToDataURL(f,800).then(url=>{ state.mahasiswa.push({name,cohort,email,photo:url}); save(); clearMhsForm(); }); }
  else{ state.mahasiswa.push({name,cohort,email,photo:null}); save(); clearMhsForm(); }
}
function clearMhsForm(){ qs('#mhs_name').value=''; qs('#mhs_email').value=''; qs('#mhs_photo').value=''; }
function delMhs(i){ if(confirm('Hapus mahasiswa?')){ state.mahasiswa.splice(i,1); save(); } }
function viewMhs(i){ const m = state.mahasiswa[i]; showModal(m.photo||placeholder(m.name), m.name, 'Angkatan: '+m.cohort+'\n'+(m.email||'')); }

/* ===== Helpers ===== */
function fileToDataURL(file, maxW=1200){ return new Promise((res,rej)=>{ const reader=new FileReader(); reader.onload=e=>{ const img=new Image(); img.onload=()=>{ const scale=Math.min(1, maxW/img.width); const canvas=document.createElement('canvas'); canvas.width=Math.round(img.width*scale); canvas.height=Math.round(img.height*scale); const ctx=canvas.getContext('2d'); ctx.drawImage(img,0,0,canvas.width,canvas.height); res(canvas.toDataURL('image/jpeg',0.8)); }; img.onerror=rej; img.src=e.target.result; }; reader.onerror=rej; reader.readAsDataURL(file); }); }
function placeholder(name){ const txt = (name||'?').split(' ').slice(0,2).map(x=>x[0]).join(''); const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='300' height='300'><rect width='100%' height='100%' fill='#0b1220'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Montserrat' font-size='72' fill='#9aa7bf'>${txt}</text></svg>`; return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg); }
function escape(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* ===== Modal ===== */
function showModal(img,title,sub){ qs('#modalPic').src = img; qs('#modalTitle').textContent = title; qs('#modalSub').textContent = sub; qs('#modal').classList.add('show'); qs('#modal').setAttribute('aria-hidden','false'); }
qs('#closeModal').addEventListener('click', ()=>{ qs('#modal').classList.remove('show'); qs('#modal').setAttribute('aria-hidden','true'); });
qs('#modal').addEventListener('click', (e)=>{ if(e.target===qs('#modal')){ qs('#modal').classList.remove('show'); qs('#modal').setAttribute('aria-hidden','true'); } });

/* ===== Export / Import ===== */
qs('#btnExport').addEventListener('click', ()=>{ const data=JSON.stringify(state, null, 2); const blob=new Blob([data], {type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='unhas_lab_export.json'; a.click(); URL.revokeObjectURL(url); });
qs('#importFile').addEventListener('change', (ev)=>{ const f=ev.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=e=>{ try{ const obj=JSON.parse(e.target.result); if(obj.dosen && obj.mahasiswa){ state = obj; save(); alert('Impor berhasil'); } else alert('Format file tidak dikenali'); }catch(err){ alert('Gagal impor: '+err.message); } }; r.readAsText(f); });

/* ===== Small UI hookups ===== */
qs('#addDosen').addEventListener('click', addDosenFromForm);
qs('#addMhs').addEventListener('click', addMhsFromForm);
qs('#clearDosen').addEventListener('click', clearDosenForm);

// cohort buttons
function renderCohortButtons(){ const wrap = document.querySelector('.cohort-row'); wrap.innerHTML=''; const allBtn = document.createElement('button'); allBtn.className='btn'; allBtn.textContent='Semua'; allBtn.dataset.cohort='all'; allBtn.addEventListener('click', ()=>renderMhs('all')); wrap.appendChild(allBtn);
  const cohorts = [...new Set(state.mahasiswa.map(m=>m.cohort))].sort((a,b)=>b-a);
  cohorts.forEach(c=>{ const b=document.createElement('button'); b.className='btn'; b.textContent=c; b.dataset.cohort=c; b.addEventListener('click', ()=>renderMhs(c)); wrap.appendChild(b); }); }

/* ===== Render all components ===== */
function renderAll(){ renderHome(); renderDosen(); renderMhs('all'); renderCohortButtons(); renderGallery(); qs('#year').textContent = new Date().getFullYear(); }

function renderGallery(){ const g = qs('#galleryGrid'); g.innerHTML=''; state.mahasiswa.slice(0,8).forEach((m,i)=>{ const img=document.createElement('img'); img.src = m.photo || `https://picsum.photos/seed/mhs${i}/400/260`; img.alt = m.name; img.style.width='100%'; img.style.height='160px'; img.style.objectFit='cover'; img.style.borderRadius='8px'; g.appendChild(img); }); state.dosen.slice(0,6).forEach((d,i)=>{ const img=document.createElement('img'); img.src = d.photo || `https://picsum.photos/seed/dosen${i}/400/260`; img.style.width='100%'; img.style.height='160px'; img.style.objectFit='cover'; img.style.borderRadius='8px'; g.appendChild(img); }); }

/* ===== Init ===== */
(function init(){ load(); renderAll(); // default to home
  // ensure only home visible
  ['lab','dosen','mahasiswa','research','gallery'].forEach(id=>{ const el = qs('#'+id); if(el) el.style.display='none'; });

  // create starfield canvas
  const canvas = document.createElement('canvas'); canvas.id='starfield'; document.body.appendChild(canvas);
  const starsCtx = canvas.getContext('2d'); function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();
  const stars=[]; for(let i=0;i<250;i++){ stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,z:Math.random()*1.2,alpha:Math.random()*0.9}); }
  function drawStars(){ starsCtx.clearRect(0,0,canvas.width,canvas.height); for(const s of stars){ starsCtx.beginPath(); starsCtx.fillStyle = `rgba(255,255,255,${s.alpha})`; starsCtx.arc(s.x,s.y, s.z+0.4,0,Math.PI*2); starsCtx.fill(); s.y -= 0.15 * (s.z+0.5); s.x += Math.sin(Date.now()/10000 + s.x)*0.02; if(s.y<0) s.y=canvas.height; if(s.x<0) s.x=canvas.width; if(s.x>canvas.width) s.x=0; } requestAnimationFrame(drawStars); }
  requestAnimationFrame(drawStars);

  // parallax planets
  const p1=document.createElement('div'); p1.className='parallax-layer planet'; p1.style.left='10%'; p1.style.top='10%'; p1.style.background='radial-gradient(circle at 35% 30%, #ff9a9e, #f06292)'; document.body.appendChild(p1);
  const p2=document.createElement('div'); p2.className='parallax-layer planet'; p2.style.right='8%'; p2.style.bottom='8%'; p2.style.width='360px'; p2.style.height='360px'; p2.style.background='radial-gradient(circle at 40% 40%, #8fd3f4, #0b69b3)'; document.body.appendChild(p2);
  function parallax(){ const s=window.scrollY; p1.style.transform = `translateY(${s*0.06}px) rotate(${s*0.02}deg)`; p2.style.transform = `translateY(${s*0.04}px) rotate(${s*0.01}deg)`; requestAnimationFrame(parallax);} requestAnimationFrame(parallax);

  // ambient music
  const audio = new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_2e2c3b2e3a.mp3?filename=ambient-space-11107.mp3'); audio.loop=true; audio.volume=0.15; let musicOn = localStorage.getItem('lab_music')==='1';
  const musicBtn = qs('#musicControl'); function updateMusicBtn(){ musicBtn.textContent = musicOn? 'ðŸ”Š Music (On)' : 'ðŸ”ˆ Music (Off)'; }
  musicBtn.addEventListener('click', ()=>{ musicOn = !musicOn; localStorage.setItem('lab_music', musicOn? '1':'0'); if(musicOn) audio.play().catch(()=>{}); else audio.pause(); updateMusicBtn(); }); if(musicOn) audio.play().catch(()=>{}); updateMusicBtn();

  // admin PIN
  let adminUnlocked = false; const ADMIN_KEY='lab_admin_pin'; const adminBtn = qs('#adminBtn'); adminBtn.addEventListener('click', ()=>{
    const current = localStorage.getItem(ADMIN_KEY);
    if(!current){ const pin = prompt('Buat PIN admin (4-6 digit):'); if(pin){ localStorage.setItem(ADMIN_KEY,pin); alert('PIN tersimpan. Klik Login lagi untuk mengakses.'); } return; }
    const attempt = prompt('Masukkan PIN admin:'); if(attempt===current){ adminUnlocked=true; alert('Admin mode aktif'); adminBtn.textContent='Logout'; adminBtn.onclick = ()=>{ adminUnlocked=false; adminBtn.textContent='Login'; adminBtn.addEventListener('click', ()=>{ /* noop */ }); location.reload(); } }
    else alert('PIN salah');
  });

  // export gallery zip
  qs('#exportZip').addEventListener('click', async ()=>{
    if(typeof JSZip==='undefined'){ alert('Library JSZip belum dimuat'); return; }
    const zip = new JSZip(); const imgs = (state.gallery||[]);
    if(imgs.length===0){ alert('Galeri kosong'); return; }
    for(let i=0;i<imgs.length;i++){ const dataURL = imgs[i]; const base = dataURL.split(',')[1]; zip.file(`image_${i+1}.jpg`, base, {base64:true}); }
    const content = await zip.generateAsync({type:'blob'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(content); a.download='gallery.zip'; a.click(); URL.revokeObjectURL(a.href);
  });

  // gallery upload handler
  const uploadInput = qs('#galleryUpload'); const uploadBtn = qs('#uploadGalleryBtn'); if(uploadBtn && uploadInput){ uploadBtn.addEventListener('click', ()=>{ const f=uploadInput.files[0]; if(!f) return alert('Pilih gambar terlebih dahulu'); fileToDataURL(f,1200).then(url=>{ state.gallery = state.gallery || []; state.gallery.push(url); save(); uploadInput.value=''; alert('Gambar berhasil diunggah ke galeri'); }); }); }

  // slideshow
  let slideshowInterval=null; function startSlideshow(){ const imgs = state.gallery||[]; if(imgs.length===0){ alert('Galeri kosong'); return; } let idx=0; slideshowInterval = setInterval(()=>{ showModal(imgs[idx%imgs.length], 'Slide '+(idx+1), 'Galeri slideshow'); idx++; }, 2500); }
  function stopSlideshow(){ if(slideshowInterval){ clearInterval(slideshowInterval); slideshowInterval=null; } }
  // attach quick controls on gallery page
  const gSection = qs('#gallery'); if(gSection){ const playBtn = document.createElement('button'); playBtn.className='btn'; playBtn.textContent='Play Slideshow'; playBtn.style.marginRight='8px'; playBtn.addEventListener('click', ()=>{ if(slideshowInterval) { stopSlideshow(); playBtn.textContent='Play Slideshow'; } else { startSlideshow(); playBtn.textContent='Stop Slideshow'; } }); gSection.insertBefore(playBtn, gSection.querySelector('#galleryGrid'));
    const zipBtn = document.createElement('button'); zipBtn.className='btn'; zipBtn.textContent='Export ZIP'; zipBtn.addEventListener('click', ()=>qs('#exportZip').click()); gSection.insertBefore(zipBtn, gSection.querySelector('#galleryGrid'));
  }

  // protect add functions unless adminUnlocked
  const origAddDosen = window.addDosenFromForm; const origAddMhs = window.addMhsFromForm;
  window.addDosenFromForm = function(){ if(!adminUnlocked){ if(!confirm('Menambah dosen memerlukan akses admin. Ingin login sebagai admin?')) return; adminBtn.click(); return; } origAddDosen(); };
  window.addMhsFromForm = function(){ if(!adminUnlocked){ if(!confirm('Menambah mahasiswa memerlukan akses admin. Ingin login sebagai admin?')) return; adminBtn.click(); return; } origAddMhs(); };

})();
</script>
</body>
</html>
